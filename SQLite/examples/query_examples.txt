# SQLite Query Examples

This file contains common SQLite queries for the learning module.

## Basic SELECT Queries

### Get all items
```sql
SELECT * FROM items;
```

### Get items ordered by price (descending)
```sql
SELECT * FROM items ORDER BY price DESC;
```

### Get items with pagination
```sql
SELECT * FROM items LIMIT 10 OFFSET 0;
```

## Filtering Queries

### Get items by category
```sql
SELECT * FROM items WHERE category = 'Electronics';
```

### Get items in price range
```sql
SELECT * FROM items WHERE price BETWEEN 20 AND 100;
```

### Search items by name (case-insensitive)
```sql
SELECT * FROM items WHERE name LIKE '%laptop%' COLLATE NOCASE;
```

### Get items with low stock
```sql
SELECT * FROM items WHERE quantity < 10;
```

## Aggregate Queries

### Count total items
```sql
SELECT COUNT(*) as total_items FROM items;
```

### Get total value of inventory
```sql
SELECT SUM(price * quantity) as total_value FROM items;
```

### Get average price by category
```sql
SELECT category, AVG(price) as avg_price, COUNT(*) as count
FROM items
GROUP BY category;
```

### Get most expensive item
```sql
SELECT * FROM items ORDER BY price DESC LIMIT 1;
```

## INSERT Queries

### Insert single item
```sql
INSERT INTO items (name, description, category, price, quantity)
VALUES ('New Item', 'Description here', 'Category', 99.99, 10);
```

### Insert multiple items
```sql
INSERT INTO items (name, description, category, price, quantity) VALUES
  ('Item 1', 'Description 1', 'Category A', 10.00, 5),
  ('Item 2', 'Description 2', 'Category B', 20.00, 10),
  ('Item 3', 'Description 3', 'Category A', 30.00, 15);
```

## UPDATE Queries

### Update single item
```sql
UPDATE items
SET price = 89.99, quantity = 20
WHERE id = 1;
```

### Update all items in a category
```sql
UPDATE items
SET price = price * 0.9
WHERE category = 'Electronics';
```

### Update timestamp
```sql
UPDATE items
SET updated_at = CURRENT_TIMESTAMP
WHERE id = 1;
```

## DELETE Queries

### Delete single item
```sql
DELETE FROM items WHERE id = 1;
```

### Delete items with zero quantity
```sql
DELETE FROM items WHERE quantity = 0;
```

### Delete old items
```sql
DELETE FROM items
WHERE created_at < datetime('now', '-1 year');
```

## Advanced Queries

### Full-text search (multiple columns)
```sql
SELECT * FROM items
WHERE name LIKE '%search%' OR description LIKE '%search%';
```

### Get items created today
```sql
SELECT * FROM items
WHERE DATE(created_at) = DATE('now');
```

### Complex filtering
```sql
SELECT * FROM items
WHERE category IN ('Electronics', 'Furniture')
  AND price > 50
  AND quantity > 0
ORDER BY price ASC;
```

### Subquery - items above average price
```sql
SELECT * FROM items
WHERE price > (SELECT AVG(price) FROM items);
```

## Index Operations

### Create indexes
```sql
CREATE INDEX idx_items_category ON items(category);
CREATE INDEX idx_items_price ON items(price);
CREATE INDEX idx_items_name ON items(name);
```

### View indexes
```sql
SELECT * FROM sqlite_master WHERE type = 'index';
```

## Table Management

### View table schema
```sql
PRAGMA table_info(items);
```

### Get database info
```sql
SELECT * FROM sqlite_master WHERE type = 'table';
```

### Analyze table statistics
```sql
ANALYZE items;
SELECT * FROM sqlite_stat1;
```

## Transaction Examples

### Basic transaction
```sql
BEGIN TRANSACTION;

INSERT INTO items (name, price, quantity) VALUES ('Item A', 10.00, 5);
UPDATE items SET quantity = quantity - 1 WHERE id = 2;

COMMIT;
```

### Rollback example
```sql
BEGIN TRANSACTION;

DELETE FROM items WHERE category = 'Test';
-- Oops, wrong category!

ROLLBACK;
```

## Backup and Export

### Export to CSV (using sqlite3 CLI)
```bash
sqlite3 database.db
.headers on
.mode csv
.output items.csv
SELECT * FROM items;
.quit
```

### Backup database
```bash
sqlite3 database.db ".backup backup.db"
```

## Performance Tips

1. **Use indexes** for frequently searched columns
2. **ANALYZE** tables periodically for query optimization
3. **Use transactions** for bulk operations
4. **PRAGMA optimize** before closing database
5. **Avoid SELECT *** in production, specify columns
6. **Use prepared statements** to prevent SQL injection

## Common SQLite Functions

### String functions
```sql
SELECT UPPER(name), LOWER(category), LENGTH(description) FROM items;
```

### Date functions
```sql
SELECT datetime(created_at, 'localtime') as local_time FROM items;
SELECT date('now', '+1 day') as tomorrow;
```

### Math functions
```sql
SELECT ROUND(price, 2), ABS(quantity - 10) FROM items;
```

## Notes

- SQLite is case-insensitive by default for ASCII characters
- Use COLLATE NOCASE for case-insensitive comparisons
- Transactions improve performance for bulk operations
- Regular VACUUM can reduce database file size
