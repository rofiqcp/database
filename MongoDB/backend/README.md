# MongoDB Backend

Node.js + Express.js backend with MongoDB database for the MongoDB Learning Module.

## üìã Overview

RESTful API backend built with Express.js and MongoDB. Provides full CRUD operations with input validation, error handling, and comprehensive API responses.

## üõ†Ô∏è Tech Stack

- **Runtime**: Node.js 18+
- **Framework**: Express.js 4.x
- **Database**: MongoDB 6+ (official Node.js driver)
- **Validation**: Validator library
- **Environment**: Dotenv
- **Dev Server**: Nodemon

## üìÅ Project Structure

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ server.js      # Express app initialization & startup
‚îÇ   ‚îú‚îÄ‚îÄ database.js    # MongoDB connection & configuration
‚îÇ   ‚îî‚îÄ‚îÄ routes.js      # API route handlers
‚îú‚îÄ‚îÄ package.json       # Dependencies & scripts
‚îú‚îÄ‚îÄ .env.example       # Environment variables template
‚îú‚îÄ‚îÄ .gitignore         # Git ignore rules
‚îî‚îÄ‚îÄ README.md          # This file
```

## üöÄ Quick Start

### Prerequisites
- Node.js 18 or higher
- MongoDB 6+ installed and running
- npm package manager

### Installation

```bash
# Navigate to backend folder
cd backend

# Install dependencies
npm install

# Create environment file
cp .env.example .env

# Edit .env with your configuration
nano .env
```

### Configuration

Edit `.env` file:

```env
PORT=3000
NODE_ENV=development
MONGODB_URI=mongodb://localhost:27017
MONGODB_DB=learning_db
CORS_ORIGIN=http://localhost:5173
```

**MongoDB Connection Options:**

Local MongoDB:
```env
MONGODB_URI=mongodb://localhost:27017
```

MongoDB with authentication:
```env
MONGODB_URI=mongodb://username:password@localhost:27017
```

MongoDB Atlas (cloud):
```env
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/
```

### Run Development Server

```bash
npm run dev
```

Server starts at `http://localhost:3000`

### Run Production Server

```bash
npm start
```

## üîå API Endpoints

### Health Check
```
GET /health
Response: { status: 'OK', database: 'MongoDB', timestamp: '...' }
```

### Items CRUD Operations

#### Get All Items
```
GET /api/data
Response: { success: true, data: [...], timestamp: '...' }
```

#### Get Single Item
```
GET /api/data/:id
Params: id (MongoDB ObjectId)
Response: { success: true, data: {...}, timestamp: '...' }
```

#### Create Item
```
POST /api/data
Body: { name, description?, category?, price?, quantity? }
Response: { success: true, data: {...}, timestamp: '...' }
Status: 201
```

#### Update Item
```
PUT /api/data/:id
Params: id (MongoDB ObjectId)
Body: { name, description?, category?, price?, quantity? }
Response: { success: true, data: {...}, timestamp: '...' }
```

#### Delete Item
```
DELETE /api/data/:id
Params: id (MongoDB ObjectId)
Response: { success: true, data: { id, message }, timestamp: '...' }
```

#### Search/Filter Items
```
POST /api/search
Body: { query?, category?, minPrice?, maxPrice? }
Response: { success: true, data: [...], timestamp: '...' }
```

## üíæ Database Operations

### MongoDB Collection Schema

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  name: String (required),    // Item name
  description: String,        // Item description
  category: String,           // Item category
  price: Number,              // Item price (default: 0)
  quantity: Number,           // Stock quantity (default: 0)
  created_at: ISODate,        // Creation timestamp
  updated_at: ISODate         // Last update timestamp
}
```

### Indexes Created

- `category` - Single field index
- `name` - Single field index  
- `created_at` - Single field index (descending)
- `name, description` - Text index for full-text search

### MongoDB Operations Used

- `find()` - Query documents
- `findOne()` - Find single document by ID
- `insertOne()` - Create new document
- `updateOne()` - Update existing document
- `deleteOne()` - Delete document
- `createIndex()` - Create indexes
- `sort()` - Sort results
- `toArray()` - Convert cursor to array

## ‚úÖ Input Validation

All inputs are validated using the `validator` library:

- **Name**: Required, non-empty string
- **Price**: Optional positive number
- **Quantity**: Optional positive integer
- **ID**: Valid MongoDB ObjectId format

## üîí Security Features

- **Input Validation**: All inputs validated before processing
- **Error Handling**: Comprehensive error handling with meaningful messages
- **CORS Protection**: Configurable CORS origins
- **ObjectId Validation**: Prevents invalid ID injection
- **Regex Injection Prevention**: Safe regex queries with proper escaping
- **Environment Variables**: Sensitive data in .env files

## üìù Code Examples

### Query Items from MongoDB

```javascript
const { getCollection } = require('./database');

async function getAllItems() {
  const collection = getCollection('items');
  const items = await collection
    .find({})
    .sort({ created_at: -1 })
    .toArray();
  return items;
}
```

### Create Item

```javascript
async function createItem(data) {
  const collection = getCollection('items');
  const newItem = {
    name: data.name,
    description: data.description || null,
    category: data.category || null,
    price: data.price || 0,
    quantity: data.quantity || 0,
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  };
  
  const result = await collection.insertOne(newItem);
  return result.insertedId;
}
```

### Search with Filters

```javascript
async function searchItems(query, category, minPrice, maxPrice) {
  const collection = getCollection('items');
  const filter = {};
  
  if (query) {
    filter.$or = [
      { name: { $regex: query, $options: 'i' } },
      { description: { $regex: query, $options: 'i' } }
    ];
  }
  
  if (category) {
    filter.category = category;
  }
  
  if (minPrice !== undefined || maxPrice !== undefined) {
    filter.price = {};
    if (minPrice !== undefined) filter.price.$gte = minPrice;
    if (maxPrice !== undefined) filter.price.$lte = maxPrice;
  }
  
  return await collection.find(filter).sort({ created_at: -1 }).toArray();
}
```

## üß™ Testing

### Manual Testing with curl

```bash
# Health check
curl http://localhost:3000/health

# Get all items
curl http://localhost:3000/api/data

# Create item
curl -X POST http://localhost:3000/api/data \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Product",
    "description": "Test description",
    "category": "Electronics",
    "price": 99.99,
    "quantity": 10
  }'

# Get item by ID
curl http://localhost:3000/api/data/507f1f77bcf86cd799439011

# Update item
curl -X PUT http://localhost:3000/api/data/507f1f77bcf86cd799439011 \
  -H "Content-Type: application/json" \
  -d '{"name": "Updated Product", "price": 149.99}'

# Delete item
curl -X DELETE http://localhost:3000/api/data/507f1f77bcf86cd799439011

# Search items
curl -X POST http://localhost:3000/api/search \
  -H "Content-Type: application/json" \
  -d '{"query": "test", "minPrice": 50, "maxPrice": 150}'
```

### MongoDB Shell Testing

```bash
# Connect to MongoDB
mongosh

# Switch to database
use learning_db

# View all items
db.items.find().pretty()

# Find by category
db.items.find({ category: 'Electronics' })

# Count items
db.items.countDocuments()

# Check indexes
db.items.getIndexes()
```

## üêõ Debugging

Enable detailed logging:

```javascript
// In database.js
MongoClient.connect(uri, { 
  useNewUrlParser: true,
  useUnifiedTopology: true,
  loggerLevel: 'debug'
})
```

View MongoDB logs:
```bash
# Check MongoDB process
ps aux | grep mongod

# View MongoDB logs
tail -f /var/log/mongodb/mongod.log
```

## üì¶ Dependencies

### Production Dependencies
- `express` - Web framework
- `cors` - CORS middleware
- `dotenv` - Environment variables
- `mongodb` - Official MongoDB Node.js driver
- `validator` - Input validation library

### Development Dependencies
- `nodemon` - Auto-restart server on file changes

## üîß Scripts

```json
{
  "scripts": {
    "dev": "nodemon src/server.js",
    "start": "node src/server.js",
    "build": "echo 'No build step required for Node.js'"
  }
}
```

## üöÄ Deployment Considerations

### Environment Variables
Ensure all production environment variables are set:
- `PORT` - Server port
- `NODE_ENV=production`
- `MONGODB_URI` - Production MongoDB connection string
- `MONGODB_DB` - Database name
- `CORS_ORIGIN` - Production frontend URL

### MongoDB Atlas (Cloud)
For production, consider MongoDB Atlas:
1. Create cluster at https://cloud.mongodb.com
2. Get connection string
3. Update `MONGODB_URI` in .env
4. Whitelist IP addresses
5. Enable authentication

### Process Management
Use PM2 for production:
```bash
npm install -g pm2
pm2 start src/server.js --name mongodb-backend
pm2 save
pm2 startup
```

## üìö Additional Resources

- [MongoDB Documentation](https://docs.mongodb.com/)
- [MongoDB Node.js Driver](https://mongodb.github.io/node-mongodb-native/)
- [Express.js Guide](https://expressjs.com/en/guide/routing.html)
- [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)

## ü§ù Contributing

This is a learning module. Feel free to:
- Add new features
- Improve error handling
- Add tests
- Enhance documentation

## üìÑ License

MIT License - Use freely for learning and commercial purposes.

---

Built as part of the MongoDB Learning Module üéì
