# Oracle Database Query Examples

This file contains example Oracle SQL queries and operations for the Learning Module.
Use these in SQL*Plus, SQL Developer, or in your Node.js code.

## Connection

-- Connect to Oracle Database
sqlplus system/oracle@localhost:1521/XEPDB1

-- Check database status
SELECT status FROM v$instance;

-- Show current user
SHOW USER;

-- Show all user tables
SELECT table_name FROM user_tables;

## Basic Queries

-- Find all items
SELECT * FROM items;

-- Find all items ordered by name
SELECT * FROM items ORDER BY name;

-- Count all items
SELECT COUNT(*) AS total FROM items;

-- Find one item by ID
SELECT * FROM items WHERE id = 1;

-- Find first item
SELECT * FROM items FETCH FIRST 1 ROW ONLY;

## Filtering

-- Find items by category
SELECT * FROM items WHERE category = 'Electronics';

-- Find items by name
SELECT * FROM items WHERE name = 'Laptop';

-- Find items with exact price
SELECT * FROM items WHERE price = 999.99;

-- Find items with price greater than 100
SELECT * FROM items WHERE price > 100;

-- Find items with price greater than or equal to 100
SELECT * FROM items WHERE price >= 100;

-- Find items with price less than 1000
SELECT * FROM items WHERE price < 1000;

-- Find items with price less than or equal to 1000
SELECT * FROM items WHERE price <= 1000;

-- Find items with price between 100 and 1000
SELECT * FROM items WHERE price BETWEEN 100 AND 1000;

-- Find items NOT equal to a value
SELECT * FROM items WHERE category != 'Electronics';

-- Find items in a list of values
SELECT * FROM items WHERE category IN ('Electronics', 'Books', 'Toys');

-- Find items NOT in a list of values
SELECT * FROM items WHERE category NOT IN ('Electronics', 'Clothing');

## Text Search

-- Case-insensitive search in name
SELECT * FROM items WHERE LOWER(name) LIKE '%laptop%';

-- Search in name or description
SELECT * FROM items
WHERE LOWER(name) LIKE '%gaming%'
   OR LOWER(description) LIKE '%gaming%';

-- Pattern matching - starts with L
SELECT * FROM items WHERE name LIKE 'L%';

-- Pattern matching - ends with 'top'
SELECT * FROM items WHERE name LIKE '%top';

-- Pattern matching - contains 'key'
SELECT * FROM items WHERE name LIKE '%key%';

-- Using REGEXP_LIKE for regex matching
SELECT * FROM items WHERE REGEXP_LIKE(name, '^L', 'i');

-- Using REGEXP_LIKE for case-insensitive search
SELECT * FROM items WHERE REGEXP_LIKE(name, 'laptop', 'i');

## Logical Operators

-- AND - Items in Electronics category with price > 500
SELECT * FROM items
WHERE category = 'Electronics'
  AND price > 500;

-- OR - Items in Electronics OR Books category
SELECT * FROM items
WHERE category = 'Electronics'
   OR category = 'Books';

-- NOT - Items NOT in Electronics category
SELECT * FROM items
WHERE NOT category = 'Electronics';

-- Complex query - (Electronics OR Books) AND price < 500
SELECT * FROM items
WHERE (category = 'Electronics' OR category = 'Books')
  AND price < 500;

## NULL Checks

-- Items where description is NULL
SELECT * FROM items WHERE description IS NULL;

-- Items where description is NOT NULL
SELECT * FROM items WHERE description IS NOT NULL;

-- Items with NVL (default for NULL)
SELECT id, name, NVL(description, 'No description') AS description FROM items;

-- Using COALESCE
SELECT id, name, COALESCE(category, 'Uncategorized') AS category FROM items;

## Sorting

-- Sort by name (ascending)
SELECT * FROM items ORDER BY name ASC;

-- Sort by name (descending)
SELECT * FROM items ORDER BY name DESC;

-- Sort by price (descending)
SELECT * FROM items ORDER BY price DESC;

-- Sort by multiple fields
SELECT * FROM items ORDER BY category ASC, price DESC;

-- Sort by created_at (newest first)
SELECT * FROM items ORDER BY created_at DESC;

-- Sort with NULLS FIRST/LAST
SELECT * FROM items ORDER BY category NULLS LAST;

## Limiting and Pagination

-- Get first 5 items (Oracle 12c+)
SELECT * FROM items FETCH FIRST 5 ROWS ONLY;

-- Skip first 10 items and get next 10 (pagination)
SELECT * FROM items
ORDER BY id
OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY;

-- Page 2 with 10 items per page
SELECT * FROM items
ORDER BY id
OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY;

-- Top 5 most expensive items
SELECT * FROM items ORDER BY price DESC FETCH FIRST 5 ROWS ONLY;

-- Using ROWNUM (legacy approach)
SELECT * FROM (SELECT * FROM items ORDER BY price DESC) WHERE ROWNUM <= 5;

## Projection (Select specific columns)

-- Select only name and price
SELECT name, price FROM items;

-- Select with alias
SELECT name AS item_name, price AS item_price FROM items;

-- Select with expression
SELECT name, price, quantity, (price * quantity) AS total_value FROM items;

-- Select distinct categories
SELECT DISTINCT category FROM items;

-- Select distinct categories count
SELECT COUNT(DISTINCT category) AS category_count FROM items;

## Aggregation

-- Count items by category
SELECT category, COUNT(*) AS item_count
FROM items
GROUP BY category;

-- Average price by category
SELECT category, ROUND(AVG(price), 2) AS avg_price
FROM items
GROUP BY category;

-- Total value (price * quantity) by category
SELECT category,
       SUM(price * quantity) AS total_value
FROM items
GROUP BY category;

-- Items with price > 100, grouped by category
SELECT category, COUNT(*) AS count
FROM items
WHERE price > 100
GROUP BY category;

-- Top 3 categories by total items
SELECT category, COUNT(*) AS item_count
FROM items
GROUP BY category
ORDER BY item_count DESC
FETCH FIRST 3 ROWS ONLY;

-- Statistics by category
SELECT category,
       COUNT(*) AS count,
       ROUND(AVG(price), 2) AS avg_price,
       MIN(price) AS min_price,
       MAX(price) AS max_price,
       SUM(quantity) AS total_quantity
FROM items
GROUP BY category
ORDER BY avg_price DESC;

-- HAVING clause - Categories with more than 2 items
SELECT category, COUNT(*) AS item_count
FROM items
GROUP BY category
HAVING COUNT(*) > 2;

## Analytic Functions

-- Row number
SELECT id, name, price,
       ROW_NUMBER() OVER (ORDER BY price DESC) AS price_rank
FROM items;

-- Rank by price within category
SELECT id, name, category, price,
       RANK() OVER (PARTITION BY category ORDER BY price DESC) AS rank_in_category
FROM items;

-- Running total of price
SELECT id, name, price,
       SUM(price) OVER (ORDER BY id) AS running_total
FROM items;

-- Lag and Lead (previous and next values)
SELECT id, name, price,
       LAG(price) OVER (ORDER BY id) AS prev_price,
       LEAD(price) OVER (ORDER BY id) AS next_price
FROM items;

## Insert Operations

-- Insert one item
INSERT INTO items (name, description, category, price, quantity)
VALUES ('Smartphone', 'Latest model smartphone', 'Electronics', 699.99, 25);
COMMIT;

-- Insert with explicit timestamps
INSERT INTO items (name, description, category, price, quantity, created_at, updated_at)
VALUES ('Tablet', 'Android tablet 10 inch', 'Electronics', 349.99, 15,
        CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
COMMIT;

-- Insert from SELECT
INSERT INTO items (name, description, category, price, quantity)
SELECT 'Copy of ' || name, description, category, price, 0
FROM items
WHERE category = 'Electronics';
COMMIT;

## Update Operations

-- Update one item by ID
UPDATE items SET price = 1199.99, updated_at = CURRENT_TIMESTAMP WHERE id = 1;
COMMIT;

-- Update multiple items by category
UPDATE items SET updated_at = CURRENT_TIMESTAMP WHERE category = 'Electronics';
COMMIT;

-- Increase price by 10%
UPDATE items SET price = price * 1.1, updated_at = CURRENT_TIMESTAMP
WHERE category = 'Electronics';
COMMIT;

-- Set minimum quantity to 1
UPDATE items SET quantity = 1 WHERE quantity = 0;
COMMIT;

-- Update with CASE
UPDATE items SET
  category = CASE
    WHEN price > 1000 THEN 'Premium'
    WHEN price > 100 THEN 'Standard'
    ELSE 'Budget'
  END,
  updated_at = CURRENT_TIMESTAMP;
COMMIT;

## Delete Operations

-- Delete one item by ID
DELETE FROM items WHERE id = 1;
COMMIT;

-- Delete items by category
DELETE FROM items WHERE category = 'Obsolete';
COMMIT;

-- Delete all items with price 0
DELETE FROM items WHERE price = 0;
COMMIT;

-- Delete all items (use with caution!)
DELETE FROM items;
COMMIT;

-- Truncate table (faster than DELETE, resets identity)
TRUNCATE TABLE items;

## Indexes

-- Show all indexes on items table
SELECT index_name, column_name, column_position
FROM user_ind_columns
WHERE table_name = 'ITEMS'
ORDER BY index_name, column_position;

-- Create index on category
CREATE INDEX idx_items_category ON items(category);

-- Create index on name
CREATE INDEX idx_items_name ON items(name);

-- Create composite index
CREATE INDEX idx_items_cat_price ON items(category, price);

-- Create unique index
CREATE UNIQUE INDEX idx_items_name_unique ON items(name);

-- Drop index
DROP INDEX idx_items_category;

## Table Operations

-- Describe table structure
DESC items;

-- Get detailed column info
SELECT column_name, data_type, data_length, nullable, data_default
FROM user_tab_columns
WHERE table_name = 'ITEMS'
ORDER BY column_id;

-- Count rows
SELECT COUNT(*) FROM items;

-- Get distinct categories
SELECT DISTINCT category FROM items ORDER BY category;

-- Check table size
SELECT segment_name, bytes/1024/1024 AS size_mb
FROM user_segments
WHERE segment_name = 'ITEMS';

## Subqueries

-- Items with above average price
SELECT * FROM items
WHERE price > (SELECT AVG(price) FROM items);

-- Items in the most popular category
SELECT * FROM items
WHERE category = (
  SELECT category FROM items
  GROUP BY category
  ORDER BY COUNT(*) DESC
  FETCH FIRST 1 ROW ONLY
);

-- Correlated subquery - items with price above category average
SELECT i.* FROM items i
WHERE i.price > (
  SELECT AVG(price) FROM items WHERE category = i.category
);

## Date Operations

-- Items created today
SELECT * FROM items WHERE TRUNC(created_at) = TRUNC(SYSDATE);

-- Items created in last 7 days
SELECT * FROM items WHERE created_at >= SYSDATE - 7;

-- Items created in last 30 days
SELECT * FROM items WHERE created_at >= SYSDATE - 30;

-- Format date
SELECT id, name, TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created
FROM items;

-- Extract year/month
SELECT id, name,
       EXTRACT(YEAR FROM created_at) AS year,
       EXTRACT(MONTH FROM created_at) AS month
FROM items;

## String Functions

-- Upper/Lower case
SELECT UPPER(name) AS upper_name, LOWER(name) AS lower_name FROM items;

-- Concatenation
SELECT name || ' - ' || category AS full_name FROM items;

-- Substring
SELECT SUBSTR(name, 1, 10) AS short_name FROM items;

-- Length
SELECT name, LENGTH(name) AS name_length FROM items;

-- Replace
SELECT REPLACE(name, 'old', 'new') AS modified_name FROM items;

-- Trim
SELECT TRIM(name) AS trimmed_name FROM items;

## Useful Administrative Commands

-- Show current session info
SELECT SYS_CONTEXT('USERENV', 'SESSION_USER') AS current_user,
       SYS_CONTEXT('USERENV', 'DB_NAME') AS database_name,
       SYS_CONTEXT('USERENV', 'HOST') AS host
FROM dual;

-- Show database version
SELECT banner FROM v$version WHERE ROWNUM = 1;

-- Show tablespace usage
SELECT tablespace_name, ROUND(bytes/1024/1024, 2) AS size_mb
FROM dba_data_files;

-- Show active sessions
SELECT sid, serial#, username, status FROM v$session
WHERE username IS NOT NULL;

## Performance

-- Explain query plan
EXPLAIN PLAN FOR SELECT * FROM items WHERE category = 'Electronics';
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);

-- Gather statistics
EXEC DBMS_STATS.GATHER_TABLE_STATS(USER, 'ITEMS');

-- Show index statistics
SELECT index_name, distinct_keys, num_rows
FROM user_indexes
WHERE table_name = 'ITEMS';

---

For more Oracle SQL examples and documentation:
https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/
